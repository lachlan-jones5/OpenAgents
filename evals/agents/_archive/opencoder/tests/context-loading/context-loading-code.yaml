id: context-loading-code
name: Context Loading Before Code Implementation
description: |
  Tests that opencoder loads context files BEFORE implementing code.
  Agent should:
  1. Present plan and get approval
  2. Load .opencode/context/core/standards/code.md
  3. Then implement the code
  
  This is CRITICAL - code without context = inconsistent patterns.

category: developer
agent: opencoder
model: anthropic/claude-sonnet-4-5

prompts:
  - text: "Create a simple User class in src/models/User.js with name and email properties"
    expectContext: false
  
  - text: "approve"
    delayMs: 2000
    expectContext: true
    contextFile: "code.md"

# Expected behavior
behavior:
  mustUseTools: [read, write]
  requiresContext: true
  minToolCalls: 2

# Context loading should NOT be violated
expectedViolations:
  - rule: context-loading
    shouldViolate: false
    severity: error
  
  - rule: approval-gate
    shouldViolate: false
    severity: error

approvalStrategy:
  type: auto-approve

timeout: 120000

tags:
  - context-loading
  - critical
  - code-standards
